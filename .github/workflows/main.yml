 name: Docker Build and Deploy to Azure Container Instance

   on:
     push:
       branches:
         - main

   jobs:
     build:
       runs-on: ubuntu-latest

       steps:
         - name: Checkout code
           uses: actions/checkout@v2

         - name: Login to Azure
           uses: azure/login@v1
           with:
             creds: ${{ secrets.AZURE_CREDENTIALS }}

         - name: Build Docker image
           run: |
             docker build -t mydockerimage .
             docker login azure
             docker tag mydockerimage <azure-registry>.azurecr.io/mydockerimage:latest
             docker push <azure-registry>.azurecr.io/mydockerimage:latest

         - name: Deploy to Azure Container Instance
           uses: azure/container-instance-action@v1
           with:
             resourceGroupName: '<resource-group>'
             containerGroupName: 'mycontainer'
             image: '<azure-registry>.azurecr.io/mydockerimage:latest'
             registryLoginServer: '<azure-registry>.azurecr.io'
             registryUsername: ${{ secrets.REGISTRY_USERNAME }}
             registryPassword: ${{ secrets.REGISTRY_PASSWORD }}
